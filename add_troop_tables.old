"""add troop tables

Revision ID: 4316f3b90b79
Revises: b1269dbd630d
Create Date: 2026-02-04 20:52:16.513197

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '4316f3b90b79'
down_revision: Union[str, Sequence[str], None] = 'b1269dbd630d'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('troop_types',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('code', sa.String(length=32), nullable=False),
    sa.Column('name', sa.String(length=64), nullable=False),
    sa.Column('tier', sa.Integer(), nullable=False),
    sa.Column('attack', sa.Integer(), nullable=False),
    sa.Column('defense', sa.Integer(), nullable=False),
    sa.Column('hp', sa.Integer(), nullable=False),
    sa.Column('speed', sa.Integer(), nullable=False),
    sa.Column('carry', sa.Integer(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_troop_types_code'), 'troop_types', ['code'], unique=True)
    op.create_table('city_troops',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('city_id', sa.Integer(), nullable=False),
    sa.Column('troop_type_id', sa.Integer(), nullable=False),
    sa.Column('count', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['city_id'], ['cities.id'], ),
    sa.ForeignKeyConstraint(['troop_type_id'], ['troop_types.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('city_id', 'troop_type_id', name='uq_city_troop_type')
    )
    op.create_index(op.f('ix_city_troops_city_id'), 'city_troops', ['city_id'], unique=False)
    op.create_index(op.f('ix_city_troops_troop_type_id'), 'city_troops', ['troop_type_id'], unique=False)
    op.create_table('raid_troops',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('raid_id', sa.Integer(), nullable=False),
    sa.Column('troop_type_id', sa.Integer(), nullable=False),
    sa.Column('count_sent', sa.Integer(), nullable=False),
    sa.Column('count_lost', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['raid_id'], ['raids.id'], ),
    sa.ForeignKeyConstraint(['troop_type_id'], ['troop_types.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('raid_id', 'troop_type_id', name='uq_raid_troop_type')
    )
    op.create_index(op.f('ix_raid_troops_raid_id'), 'raid_troops', ['raid_id'], unique=False)
    op.create_index(op.f('ix_raid_troops_troop_type_id'), 'raid_troops', ['troop_type_id'], unique=False)
    op.drop_index(op.f('ix_building_upgrades_city_id'), table_name='building_upgrades')
    op.drop_index(op.f('ix_building_upgrades_completes_at'), table_name='building_upgrades')
    op.drop_index(op.f('ix_building_upgrades_status'), table_name='building_upgrades')
    op.drop_table('building_upgrades')
    op.drop_index(op.f('ix_city_buildings_city_id'), table_name='city_buildings')
    op.drop_index(op.f('ix_city_buildings_key'), table_name='city_buildings')
    op.drop_table('city_buildings')
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('city_buildings',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('city_id', sa.INTEGER(), nullable=False),
    sa.Column('key', sa.TEXT(), nullable=False),
    sa.Column('level', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.Column('updated_at', sa.TEXT(), nullable=False),
    sa.ForeignKeyConstraint(['city_id'], ['cities.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('city_id', 'key', name=op.f('uq_city_buildings_city_key'))
    )
    op.create_index(op.f('ix_city_buildings_key'), 'city_buildings', ['key'], unique=False)
    op.create_index(op.f('ix_city_buildings_city_id'), 'city_buildings', ['city_id'], unique=False)
    op.create_table('building_upgrades',
    sa.Column('id', sa.INTEGER(), nullable=True),
    sa.Column('city_id', sa.INTEGER(), nullable=False),
    sa.Column('status', sa.TEXT(), nullable=False),
    sa.Column('building_key', sa.TEXT(), nullable=False),
    sa.Column('from_level', sa.INTEGER(), nullable=False),
    sa.Column('to_level', sa.INTEGER(), nullable=False),
    sa.Column('started_at', sa.TEXT(), nullable=False),
    sa.Column('completes_at', sa.TEXT(), nullable=False),
    sa.Column('cost_food', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.Column('cost_wood', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.Column('cost_stone', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.Column('cost_iron', sa.INTEGER(), server_default=sa.text('0'), nullable=False),
    sa.ForeignKeyConstraint(['city_id'], ['cities.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('city_id', 'status', name=op.f('uq_building_upgrades_city_status'))
    )
    op.create_index(op.f('ix_building_upgrades_status'), 'building_upgrades', ['status'], unique=False)
    op.create_index(op.f('ix_building_upgrades_completes_at'), 'building_upgrades', ['completes_at'], unique=False)
    op.create_index(op.f('ix_building_upgrades_city_id'), 'building_upgrades', ['city_id'], unique=False)
    op.drop_index(op.f('ix_raid_troops_troop_type_id'), table_name='raid_troops')
    op.drop_index(op.f('ix_raid_troops_raid_id'), table_name='raid_troops')
    op.drop_table('raid_troops')
    op.drop_index(op.f('ix_city_troops_troop_type_id'), table_name='city_troops')
    op.drop_index(op.f('ix_city_troops_city_id'), table_name='city_troops')
    op.drop_table('city_troops')
    op.drop_index(op.f('ix_troop_types_code'), table_name='troop_types')
    op.drop_table('troop_types')
    # ### end Alembic commands ###
